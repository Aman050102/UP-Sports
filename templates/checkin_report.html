{# เปิดใช้งานแท็ก {% static %} ของ Django สำหรับอ้างไฟล์ใน STATIC_URL #}
{% load static %}
<!doctype html>
<html lang="th">
<head>
  <!-- รองรับภาษาไทย -->
  <meta charset="utf-8">
  <!-- ทำให้หน้าเหมาะกับอุปกรณ์พกพา -->
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- ชื่อหน้าเบราว์เซอร์/แท็บ -->
  <title>UP-FMS รายงานผู้เข้าใช้สนาม</title>
  <!-- ให้เบราว์เซอร์รองรับทั้ง light/dark mode -->
  <meta name="color-scheme" content="light dark">
  <!-- ไอคอนแท็บ (favicon) โหลดจากโฟลเดอร์ static -->
  <link rel="icon" href="{% static 'img/Logo_of_University_of_Phayao.svg.png' %}" type="image/png">

  <!-- ไฟล์ CSS หลักของเพจรายงาน -->
  <link rel="stylesheet" href="{% static 'assets/css/checkin_report.css' %}">

  <!-- Chart.js สำหรับวาดกราฟ -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>

  <!-- ไลบรารีสำหรับ Export: Excel / PDF / DOCX -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.19.3/dist/xlsx.full.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" defer></script>
  <!-- ปลั๊กอินตารางของ jsPDF (ต้องโหลด "หลัง" jsPDF) -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/docx@8.5.0/build/index.umd.min.js" defer></script>

  <!-- โค้ดของเรา (ตอนนี้ defer เช่นกัน) -->
  <script src="{% static 'js/checkin_report.js' %}" defer></script>
</head>

<body>
  <!-- แถบส่วนหัวของหน้า -->
  <header class="topbar" aria-label="University Bar">
    <div class="brand">
      <!-- โลโก้หน่วยงาน (มี alt เพื่อการเข้าถึงที่ดี) -->
      <img src="{% static 'img/logoDSASMART.png' %}" alt="DSA" class="brand-logo">
    </div>
  </header>

  <main>
    <!-- การ์ดหลักครอบเครื่องมือค้นหา/กรอง + กราฟ -->
    <section class="card">
      <!-- แถบเครื่องมือ (ฟิลเตอร์/ตัวเลือก) -->
      <div class="toolbar">
        <!-- เลือกช่วงวันที่สำหรับดึงข้อมูล -->
        <label>ช่วงวันที่:
          <input type="date" id="from"> -
          <input type="date" id="to">
        </label>

        <!-- โหมดเวลาสำหรับจัดกลุ่มข้อมูลในกราฟ -->
        <label>มุมมองกราฟ:
          <select id="timeMode">
            <option value="hour">รายชั่วโมง</option>
            <option value="day">รายวัน</option>
            <option value="month">รายเดือน</option>
            <option value="year">รายปี</option>
          </select>
        </label>

        <!-- ค้นหาตามชื่อสนาม -->
        <label>สนาม:
          <input type="text" id="q" placeholder="ชื่อสนาม" style="min-width:200px">
        </label>

        <!-- ดันชิปไปชิดขวา -->
        <span style="flex:1"></span>

        <!-- ชิปเลือกหมวดสนาม (เลือกได้อย่างน้อย 1, โค้ด JS จะจัดการคลาส .selected) -->
        <div class="chips" id="chips">
          <span class="chip selected" data-k="all"><small>ทั้งหมด</small></span>
          <span class="chip" data-k="outdoor" style="border-color:var(--outdoor)"><small>สนามกลางแจ้ง</small></span>
          <span class="chip" data-k="badminton" style="border-color:var(--badminton)"><small>สนามแบดมินตัน</small></span>
          <span class="chip" data-k="track" style="border-color:var(--track)"><small>ลู่และลาน</small></span>
          <span class="chip" data-k="pool" style="border-color:var(--pool)"><small>สระว่ายน้ำ</small></span>
        </div>
      </div>

      <!-- แถวส่วนแสดงกราฟและปุ่ม Export -->
      <div class="chart-row" id="chartRow">
        <!-- ปุ่มดาวน์โหลดผลลัพธ์ -->
        <div class="chart-actions">
          <!-- โค้ด JS ควรอ้าง id เหล่านี้เพื่อทำงาน export -->
          <button id="btnExcel">ดาวน์โหลด Excel</button>
          <button id="btnPDF">ดาวน์โหลด PDF</button>
          <button id="btnDoc">ดาวน์โหลด DOCX</button>
          <button id="btnPrint">พิมพ์เป็น PDF (บราวเซอร์)</button>
        </div>

        <!-- พื้นที่กราฟ (Chart.js จะวาดลงใน <canvas>) -->
        <div class="chart-wrap">
          <canvas id="chart" aria-label="chart"></canvas>
        </div>
      </div>
    </section>

    <!-- กล่องใหญ่โชว์ count รวม (เช่น จำนวนสนามที่ตรงเงื่อนไข) -->
    <section class="bigbox" id="bigbox">
      สนามทั้งหมด
      <b id="bigcount">0</b>
      <!-- แนะนำ: ใส่ aria-live="polite" ที่ <b> ถ้าจะอัปเดตตัวเลขด้วย JS -->
    </section>

    <!-- กล่องสถิติย่อย 5 รายการ -->
    <section class="card stats" id="stats">
      <div class="stat"><small>รวมรายการ</small><div><b id="st-total">0</b></div></div>
      <div class="stat"><small>สนามกลางแจ้ง</small><div><b id="st-outdoor">0</b></div></div>
      <div class="stat"><small>สนามแบดมินตัน</small><div><b id="st-badminton">0</b></div></div>
      <div class="stat"><small>สระว่ายน้ำ</small><div><b id="st-pool">0</b></div></div>
      <div class="stat"><small>ลู่ - ลาน</small><div><b id="st-track">0</b></div></div>
    </section>

    <!-- ตารางรายการเข้าใช้ (แสดงข้อมูลดิบ) -->
    <section class="card table-card">
      <!-- แถบหัวตาราง (ข้อความด้านบน) -->
      <div class="table-headband" id="tableHeadText">
        เวลา&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;วันที่ (session)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;สนาม
      </div>

      <!-- ส่วนตารางจริง (เลื่อนแนวนอนได้) -->
      <div class="table-wrap">
        <table id="table" aria-label="รายการเข้าใช้">
          <thead id="thead">
            <!-- แนะนำ: เพิ่ม scope="col" เพื่อการเข้าถึงที่ดี -->
            <tr><th scope="col">เวลา</th><th scope="col">วันที่ (session)</th><th scope="col">สนาม</th></tr>
          </thead>
          <tbody></tbody> <!-- JS จะเติม <tr> จากข้อมูลที่ดึงมา -->
        </table>
      </div>
    </section>
  </main>

</body>
</html>